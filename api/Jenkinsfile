pipeline {
    agent any

    stages {
        stage('Build and Deploy') {
            steps {
                script {
                    withDockerRegistry(credentialsId: 'docker-hub', url: 'https://index.docker.io/v1/') {
                        step([
                            $class: 'DockerComposeBuilder',
                            dockerComposeFile: 'docker-compose.yml',
                            option: [
                                $class: 'StartService',
                                scale: 1,
                                service: 'api'
                            ],
                            useCustomDockerComposeFile: true
                        ])
                    }
                }
            }
        }
    }

    post {
        always {
            cleanWs()
        }
    }
}
