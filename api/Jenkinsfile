pipeline {
    agent any

    environment {
        DOCKERHUB_CREDENTIALS = credentials('docker-hub')
        IMAGE_NAME = 'lenhuthao/microservices'
        IMAGE_TAG = '0.0.1'
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

//         stage('Build Docker Image') {
//             steps {
//                 script {
//                     sh 'mvn clean install package'
//                 }
//             }
//             steps {
//                 script {
//                     docker.build("${IMAGE_NAME}:${IMAGE_TAG}", "-f ./Dockerfile .")
//                 }
//             }
//         }
        stage('Run Docker Compose') {
            steps {
                  script {
                    sh 'cd api'
                    sh 'docker-compose up'
                    sh 'docker-compose push'
                  }
            }
        }

//         stage('Push Docker Image') {
//             steps {
//                 script {
//                     docker.withRegistry('https://index.docker.io/v1/', DOCKERHUB_CREDENTIALS) {
//                         docker.image("${IMAGE_NAME}:${IMAGE_TAG}").push()
//                         sh 'docker-compose push'
//                     }
//                 }
//             }
//         }
    }
}
